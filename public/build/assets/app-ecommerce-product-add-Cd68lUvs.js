let a=[],m=[];(function(){const r=document.querySelector(".comment-editor");if(r){const l=new Quill(r,{modules:{toolbar:".comment-toolbar"},placeholder:"Product Description",theme:"snow"});typeof description<"u"&&(console.log(description),l.root.innerHTML=description)}const n=new Date,c=document.querySelector(".product-date");c&&c.flatpickr({monthSelectorType:"static",defaultDate:n})})();$(function(){var r=$(".select2");r.length&&r.each(function(){var s=$(this);select2Focus(s),s.wrap('<div class="position-relative"></div>').select2({dropdownParent:s.parent(),placeholder:s.data("placeholder")})});var n=$(".form-repeater");if(n.length){var c=2,l=1;n.on("submit",function(s){s.preventDefault()}),n.repeater({show:function(){var s=$(this).find(".form-control, .form-select"),i=$(this).find(".form-label");s.each(function(e){var o="form-repeater-"+c+"-"+l;$(s[e]).attr("id",o),$(i[e]).attr("for",o),l++}),c++,$(this).slideDown(),$(".select2-container").remove(),$(".select2.form-select").select2({placeholder:"Placeholder text"}),$(".select2-container").css("width","100%");var t=$(this);select2Focus(t),$(".form-repeater:first .form-select").select2({dropdownParent:$(this).parent(),placeholder:"Placeholder text"}),$(".position-relative .select2").each(function(){$(this).select2({dropdownParent:$(this).closest(".position-relative")})})}})}});document.addEventListener("DOMContentLoaded",function(){const r=document.getElementById("eCommerceProductAddForm");if(!r){console.error("Form not found! Ensure it exists before initializing.");return}const n=FormValidation.formValidation(r,{fields:{productTitle:{validators:{notEmpty:{message:"Please enter Product name"}}},productSku:{validators:{notEmpty:{message:"Please enter Product SKU"}}},productBarcode:{validators:{notEmpty:{message:"Please enter Product Barcode"}}},productPrice:{validators:{notEmpty:{message:"Please enter Product Price"}}},productCategory:{validators:{notEmpty:{message:"Please select Product Category"}}},productStocks:{validators:{notEmpty:{message:"Please enter Product Stock"}}},productStatus:{validators:{notEmpty:{message:"Please select Product Status"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"is-valid",rowSelector:function(i,t){return".mb-5"}}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}),c=`<div class="dz-preview dz-file-preview">
<div class="dz-details">
  <div class="dz-thumbnail">
    <img data-dz-thumbnail>
    <span class="dz-nopreview">No preview</span>
    <div class="dz-success-mark"></div>
    <div class="dz-error-mark"></div>
    <div class="dz-error-message"><span data-dz-errormessage></span></div>
    <div class="progress">
      <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuemin="0" aria-valuemax="100" data-dz-uploadprogress></div>
    </div>
  </div>
  <div class="dz-filename" data-dz-name></div>
  <div class="dz-size" data-dz-size></div>
</div>
</div>`,l=document.querySelector("#dropzone-basic"),s=new Dropzone(l,{url:"/api/products/product-image-upload",previewTemplate:c,parallelUploads:1,maxFilesize:5,acceptedFiles:".jpg,.jpeg,.png",addRemoveLinks:!0,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},maxFiles:5,init:function(){let i=this;typeof existingImages<"u"&&existingImages.length>0&&existingImages.forEach(function(t){console.log(storagePath+t.url);let e={name:t.name,size:123456,id:t.id};i.emit("addedfile",e),i.emit("thumbnail",e,storagePath+t.url),i.emit("complete",e),i.files.push(e),a.push(t.image_id)}),this.on("addedfile",function(t){this.files.length>5&&this.removeFile(this.files[0])}),this.on("success",function(t,e){if(e.success){toastr.options={positionClass:"toast-top-left"},toastr.success(e.message),a.push(e.id);const o={id:e.id,original_name:e.original_name,image:e.image};console.log(o),m.push(o)}else toastr.error(e.message)}),this.on("error",function(t,e){toastr.error(e.message)}),this.on("removedfile",function(t){console.log(t.name);const e=m.find(d=>d.original_name===t.name);let o=null;if(typeof existingImages<"u"&&existingImages.length>0&&(o=existingImages.find(d=>d.name===t.name),o&&(a=a.filter(d=>d!==o.image_id))),e){const d=e.image;d?fetch("/api/products/product-image-delete",{method:"POST",body:JSON.stringify({image:d,image_id:e.id}),dataType:"json",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(u=>{a=a.filter(p=>p!==e.id)}).catch(u=>{console.error("Error:",u),alert("An unexpected error occurred.")}):console.error("Product image element not found.")}})}});n.on("core.form.valid",function(){const i=r.querySelector('[type="submit"]');if(!i){console.error("Submit button not found!");return}i.disabled=!0;let t=new FormData(r);a.forEach(o=>{console.log(a),t.append("productImage[]",o)});let e=document.querySelector("#ecommerce-category-description .ql-editor").innerHTML;t.append("description",e),fetch(r.action,{method:r.method,body:t,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(o=>o.json()).then(o=>{toastr.options={positionClass:"toast-top-left"},o.success?(toastr.success(o.message),n.resetForm(!0),a=[],m=[],document.querySelector("#ecommerce-category-description .ql-editor").innerHTML="",s.removeAllFiles(),location.reload()):toastr.error(o.message)}).catch(o=>{console.error("Error:",o),alert("An unexpected error occurred.")}).finally(()=>{i.disabled=!1})})});
